# Malware Checker

[![Build Status](https://travis-ci.org/CBIConsulting/php-malware-checker.svg)](https://travis-ci.org/CBIConsulting/php-malware-checker)
[![Packagist](https://img.shields.io/packagist/dt/cbi/php-malware-checker.svg)](https://packagist.org/packages/CBIConsulting/php-malware-checker)
[![license](https://img.shields.io/github/license/CBIConsulting/php-malware-checker.svg)](https://github.com/CBIConsulting/php-malware-checker/blob/master/LICENSE)
[![GitHub issues](https://img.shields.io/github/issues/CBIConsulting/php-malware-checker.svg)](https://github.com/CBIConsulting/php-malware-checker/issues)

This package checks if a given hash or file is registered as malware in [Team Cymru](https://www.team-cymru.org/) database.

## Installation

Install via composer:

```
composer require cbi/php-malware-checker
```

## How to use it

If you don't have the hash you can generate it using a resouce or the uri to the file, by default it uses the `md5` algo:

```
// Generate a hash from a resource
MalwareChecker::makeHash($resouce); // fea80f2db003d4ebc4536023814aa885
MalwareChecker::makeHash($resouce, 'sha1'); // 38f00f8738e241daea6f37f6f55ae8414d7b0219
// Generate a hash from an uri
MalwareChecker::makeHash($uri); // fea80f2db003d4ebc4536023814aa885
// Generate all supported hashes supported by the application (md5, sha1, sha256)
MalwareChecker::makeHashes($resouce) // ['fea80f2db003d4ebc4536023814aa885', '38f00f8738e241daea6f37f6f55ae8414d7b0219', '16aba5393ad72c0041f5600ad3c2c52ec437a2f0c7fc08fadfc3c0fe9641d7a3']
```

To check the generated hashes you can use two methods, `check` and `checkMany`, they use different protocols to avoid cluttering the database.

To check a single hash use the following function:

```
MalwareChecker::check($infectedHash);   // ['hash' => 'f58628917abcbcfb2b2258b6b46bf721', timestamp => '1511919759' detection_percentage => '68']
MalwareChecker::check($safeHash);       // false
```

To check multiple hashed use `checkMany` method, this method only returns the infected hashes among all the provided:

```
MalwareChecker::checkMany($hashes); // [ ... ['hash' => 'f58628917abcbcfb2b2258b6b46bf721', timestamp => '1511919759' detection_percentage => '68']]
```

## Testing

Execute tests using `vendor/bin/phpunit` from the project root.
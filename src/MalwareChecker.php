<?php

namespace Cbi\MalwareChecker;

use Cbi\MalwareChecker\Response;

class MalwareChecker {

    function __construct()
    {
        //
    }

    /**
     * Check a single hash using the DNS protocol
     * @param  string $hash The hash to check
     * @return Response
     */
    public function check(string $hash) : Response
    {
        $dnsResponse = dns_get_record($hash.'.malware.hash.cymru.com', DNS_TXT)[0];
        return new Response($hash);
        // TODO Return complete Response object
    }

    /**
     * Check multiple hashes using the whois protocol
     * @param  array  $hashes The hashes to check
     * @return array         An array of responses
     */
    public function checkMany(array $hashes) : array
    {
        // Open a Socket connection to our WHOIS server
        $fp = fsockopen("hash.cymru.com", 43);
        // Send the data
        fwrite($fp, "begin\r\n" . implode("\r\n",$hashes) . "end\r\n");
        // Listen for data and "append" all the bits of information to
        // our result variable until the data stream is finished
        while (!feof($fp)) {
            $whoisResponse .= fgets($fp, 128);
        }
        fclose($fp);

        // TODO Return array of Response object
    }
}
